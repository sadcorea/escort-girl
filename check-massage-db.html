<!DOCTYPE html>
<html>
<head>
    <title>ë§ˆì‚¬ì§€ DB í™•ì¸</title>
</head>
<body>
    <h1>ë§ˆì‚¬ì§€ DB ë°ì´í„° í™•ì¸ ì¤‘...</h1>
    <pre id="output"></pre>
    
    <script>
    async function checkMassageDB() {
        const output = document.getElementById('output');
        
        try {
            const response = await fetch('http://localhost:8080/api/notion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    database_id: '203e5f74-c72e-815d-8f39-d2946ee85c0a',
                    sorts: [
                        {
                            property: 'ID',
                            direction: 'ascending'
                        }
                    ]
                })
            });

            const data = await response.json();
            
            let result = '=== ë§ˆì‚¬ì§€ DB ë¶„ì„ ê²°ê³¼ ===\n\n';
            
            if (data.results && data.results.length > 0) {
                // ì²« ë²ˆì§¸ ì—…ì²´ ì •ë³´
                const firstItem = data.results[0];
                const props = firstItem.properties;
                
                result += 'ğŸ“‹ í•„ë“œ ëª©ë¡:\n';
                result += Object.keys(props).join(', ') + '\n\n';
                
                result += 'ğŸ“Š ì²« ë²ˆì§¸ ì—…ì²´ ìƒì„¸:\n';
                
                // ID í™•ì¸
                if (props.ID) {
                    result += `ID: ${props.ID.number || 'N/A'}\n`;
                }
                
                // ì´ë¦„/ì œëª© ì°¾ê¸°
                const nameField = Object.keys(props).find(key => 
                    props[key].type === 'title' || 
                    key.includes('ì´ë¦„') || 
                    key.includes('ì—…ì²´')
                );
                if (nameField) {
                    const titleArray = props[nameField].title || props[nameField].rich_text || [];
                    const name = titleArray[0]?.plain_text || 'N/A';
                    result += `ì—…ì²´ëª… (${nameField}): ${name}\n`;
                }
                
                // ì´ë¯¸ì§€ í•„ë“œ ì°¾ê¸°
                const imageFields = Object.keys(props).filter(key => 
                    props[key].type === 'files' || 
                    key.includes('ì‚¬ì§„') || 
                    key.includes('ì´ë¯¸ì§€')
                );
                result += `\nğŸ–¼ï¸ ì´ë¯¸ì§€ í•„ë“œ: ${imageFields.join(', ')}\n`;
                
                // í…ìŠ¤íŠ¸ í•„ë“œë“¤
                const textFields = Object.keys(props).filter(key => 
                    props[key].type === 'rich_text' || 
                    props[key].type === 'url' ||
                    props[key].type === 'phone_number'
                );
                result += `\nğŸ“ í…ìŠ¤íŠ¸/URL/ì „í™” í•„ë“œ:\n`;
                textFields.forEach(field => {
                    const value = props[field];
                    let content = '';
                    if (value.type === 'rich_text' && value.rich_text.length > 0) {
                        content = value.rich_text[0].plain_text;
                    } else if (value.type === 'url') {
                        content = value.url || '';
                    } else if (value.type === 'phone_number') {
                        content = value.phone_number || '';
                    }
                    result += `  ${field}: ${content || 'N/A'}\n`;
                });
                
                result += `\nğŸ“Œ ì „ì²´ ì—…ì²´ ìˆ˜: ${data.results.length}ê°œ\n`;
                
                // ëª¨ë“  ì—…ì²´ì˜ ì´ë¦„ ëª©ë¡
                result += '\nğŸ“‹ ë“±ë¡ëœ ì—…ì²´ ëª©ë¡:\n';
                data.results.forEach((item, index) => {
                    const itemProps = item.properties;
                    const itemNameField = Object.keys(itemProps).find(key => 
                        itemProps[key].type === 'title'
                    );
                    if (itemNameField && itemProps[itemNameField].title[0]) {
                        result += `${index + 1}. ${itemProps[itemNameField].title[0].plain_text}\n`;
                    }
                });
            }
            
            output.textContent = result;
            
            // ì½˜ì†”ì—ë„ ì¶œë ¥
            console.log('ì „ì²´ ë°ì´í„°:', data);
            
        } catch (error) {
            output.textContent = 'ì—ëŸ¬ ë°œìƒ: ' + error.message;
            console.error('ì—ëŸ¬:', error);
        }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    checkMassageDB();
    </script>
</body>
</html>
