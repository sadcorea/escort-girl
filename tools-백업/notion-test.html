<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…¸ì…˜ API ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .config-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section {
            background: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #0084ff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0066cc;
        }
        .result {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ğŸ”— ë…¸ì…˜ API ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    
    <div class="config-section">
        <h2>âš™ï¸ ì„¤ì •</h2>
        <div>
            <label>Integration Token:</label>
            <input type="text" id="apiKey" placeholder="secret_xxxxxxxxxxxxxxxxxxxxxxx" />
        </div>
        <div>
            <label>Database ID:</label>
            <input type="text" id="databaseId" placeholder="32ìë¦¬ ë°ì´í„°ë² ì´ìŠ¤ ID" />
        </div>
        <button onclick="saveConfig()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testConnection()">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testQuery()">ğŸ“„ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì§€ìš°ê¸°</button>
        
        <div id="testResults" class="result"></div>
    </div>

    <script>
        // ì„¤ì • ì €ì¥/ë¡œë“œ
        function saveConfig() {
            const apiKey = document.getElementById('apiKey').value;
            const databaseId = document.getElementById('databaseId').value;
            
            if (!apiKey || !databaseId) {
                alert('API Keyì™€ Database IDë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            localStorage.setItem('notion_api_key', apiKey);
            localStorage.setItem('notion_database_id', databaseId);
            
            addResult('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function loadConfig() {
            const apiKey = localStorage.getItem('notion_api_key');
            const databaseId = localStorage.getItem('notion_database_id');
            
            if (apiKey) document.getElementById('apiKey').value = apiKey;
            if (databaseId) document.getElementById('databaseId').value = databaseId;
        }
        
        // ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            const databaseId = document.getElementById('databaseId').value;
            
            if (!apiKey || !databaseId) {
                addResult('âŒ API Keyì™€ Database IDë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            addResult('ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', '');
            
            try {
                const response = await fetch(`https://api.notion.com/v1/databases/${databaseId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'Notion-Version': '2022-06-28'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('âœ… ë…¸ì…˜ API ì—°ê²° ì„±ê³µ!', 'success');
                    addResult(`ë°ì´í„°ë² ì´ìŠ¤ ì œëª©: ${data.title[0]?.plain_text || 'ì œëª© ì—†ìŒ'}`, 'success');
                    addResult(`ì†ì„± ê°œìˆ˜: ${Object.keys(data.properties).length}ê°œ`, 'success');
                } else {
                    const errorData = await response.json();
                    addResult('âŒ ì—°ê²° ì‹¤íŒ¨:', 'error');
                    addResult(`ìƒíƒœ ì½”ë“œ: ${response.status}`, 'error');
                    addResult(`ì—ëŸ¬ ë©”ì‹œì§€: ${errorData.message}`, 'error');
                }
            } catch (error) {
                addResult('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', 'error');
                addResult(error.message, 'error');
            }
        }
        
        // ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸
        async function testQuery() {
            const apiKey = document.getElementById('apiKey').value;
            const databaseId = document.getElementById('databaseId').value;
            
            if (!apiKey || !databaseId) {
                addResult('âŒ API Keyì™€ Database IDë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            addResult('ğŸ”„ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹œì‘...', '');
            
            try {
                const response = await fetch(`https://api.notion.com/v1/databases/${databaseId}/query`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'Notion-Version': '2022-06-28'
                    },
                    body: JSON.stringify({
                        page_size: 5
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('âœ… ë°ì´í„° ì¡°íšŒ ì„±ê³µ!', 'success');
                    addResult(`ì´ ${data.results.length}ê°œ í•­ëª© ì¡°íšŒë¨`, 'success');
                    
                    // ê° í”„ë¡œí•„ì˜ ê¸°ë³¸ ì •ë³´ë§Œ ê°„ë‹¨íˆ í‘œì‹œ
                    if (data.results.length > 0) {
                        addResult('\nğŸ“„ ì¡°íšŒëœ í”„ë¡œí•„ë“¤:', 'success');
                        data.results.forEach((item, index) => {
                            const props = item.properties;
                            const name = props['ì´ë¦„']?.title?.[0]?.plain_text || 'ì´ë¦„ ì—†ìŒ';
                            const id = props['**ID**']?.number || 'ë²ˆí˜¸ ì—†ìŒ';
                            const age = props['**ë‚˜ì´**']?.number || 'ë‚˜ì´ ì—†ìŒ';
                            
                            addResult(`[${index + 1}] ${name} (ID: ${id}, ë‚˜ì´: ${age})`, '');
                        });
                    }
                } else {
                    const errorData = await response.json();
                    addResult('âŒ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', 'error');
                    addResult(`ìƒíƒœ ì½”ë“œ: ${response.status}`, 'error');
                    addResult(`ì—ëŸ¬ ë©”ì‹œì§€: ${errorData.message}`, 'error');
                }
            } catch (error) {
                addResult('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', 'error');
                addResult(error.message, 'error');
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function addResult(message, type = '') {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.textContent += `[${timestamp}] ${message}\n`;
            
            if (type) {
                resultsDiv.className = `result ${type}`;
            }
            
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('testResults').textContent = '';
            document.getElementById('testResults').className = 'result';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', loadConfig);
    </script>
</body>
</html>