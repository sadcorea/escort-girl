<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>당신만을 위한 깊은 휴식 - EchoPal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 상단 메뉴바 모듈 -->
    <div id="header-menu"></div>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <div class="container">
            <!-- 페이지 헤더 모듈 -->
            <div id="page-header"></div>

            <!-- 프리미엄 광고 모듈 -->
            <div id="premium-ads"></div>

            <!-- 검색/필터 모듈 -->
            <div id="search-filter"></div>

            <!-- 업체 목록 모듈 -->
            <div id="shop-grid"></div>
        </div>
    </div>

    <!-- JavaScript 모듈들 -->
    <script src="js/massage-list.js"></script>
    <script src="js/massage-main.js"></script>

    <script>
        // 모듈 로드 시스템
        class ModuleLoader {
            constructor() {
                this.modules = [
                    { id: 'header-menu', file: 'modules/header-menu.html' },
                    { id: 'page-header', file: 'modules/page-header.html' },
                    { id: 'premium-ads', file: 'modules/premium-ads.html' },
                    { id: 'search-filter', file: 'modules/search-filter.html' },
                    { id: 'shop-grid', file: 'modules/shop-grid.html' }
                ];
                this.loadAllModules();
            }

            async loadAllModules() {
                console.log('🔄 모듈 로드 시작...');
                
                try {
                    // 모든 모듈 병렬 로드
                    const loadPromises = this.modules.map(module => this.loadModule(module));
                    await Promise.all(loadPromises);
                    
                    console.log('✅ 모든 모듈 로드 완료!');
                    
                    // 모듈 로드 완료 후 메인 앱 초기화
                    this.initializeApp();
                } catch (error) {
                    console.error('❌ 모듈 로드 실패:', error);
                }
            }

            async loadModule({ id, file }) {
                try {
                    console.log(`🔄 ${id} 모듈 로드 시작: ${file}`);
                    const response = await fetch(file);
                    if (!response.ok) {
                        throw new Error(`모듈 로드 실패: ${file}`);
                    }
                    
                    const html = await response.text();
                    const container = document.getElementById(id);
                    
                    if (container) {
                        container.innerHTML = html;
                        console.log(`✅ ${id} 모듈 로드 완료`);
                        
                        // 특별히 shop-grid 로드 완료 시 확인
                        if (id === 'shop-grid') {
                            setTimeout(() => {
                                const grid = document.getElementById('massageGrid');
                                const pagination = document.getElementById('pagination');
                                console.log('🔍 DOM 요소 확인:', {
                                    massageGrid: !!grid,
                                    pagination: !!pagination
                                });
                            }, 100);
                        }
                    } else {
                        console.warn(`⚠️ ${id} 컨테이너를 찾을 수 없음`);
                    }
                } catch (error) {
                    console.error(`❌ ${id} 모듈 로드 실패:`, error);
                }
            }

            initializeApp() {
                // 모듈 로드 완료 후 마사지 앱 초기화
                if (typeof MassageList !== 'undefined' && typeof initializeMassageApp === 'function') {
                    console.log('✅ 마사지 앱 초기화 시작');
                    initializeMassageApp();
                } else {
                    console.error('❌ MassageList 클래스 또는 초기화 함수를 찾을 수 없음');
                }
            }
        }

        // 모듈 로더 시작
        document.addEventListener('DOMContentLoaded', () => {
            new ModuleLoader();
        });
    </script>
</body>
</html>